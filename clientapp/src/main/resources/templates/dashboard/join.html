<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    th:replace="~{dashboard/layout :: layout('Join Event - SI-VOTING', 'join', ~{::content})}">
<th:block th:fragment="content">
    <section class="rounded-3xl p-8 md:p-12 shadow-xl bg-gradient-to-br from-white/90 via-white/80 to-primary/10 border border-white/70">
        <div class="grid gap-8 lg:grid-cols-[1.3fr_1fr] items-center">
            <div class="space-y-4">
                <p class="inline-flex items-center gap-2 text-xs tracking-[0.4em] uppercase text-primary/70 font-semibold">
                    <span class="w-2 h-2 rounded-full bg-secondary"></span>
                    Join Event
                </p>
                <h1 class="text-3xl md:text-4xl font-extrabold text-primary leading-tight">
                    Temukan Event Publik dan <span class="text-secondary">Salurkan Suaramu</span>
                </h1>
                <p class="text-slate-600 text-base md:text-lg leading-relaxed">
                    Jelajahi event voting yang sedang berlangsung, pilih kandidat favoritmu, dan dukung perubahan dari mana saja.
                </p>
                <div class="flex flex-col lg:flex-row gap-4 pt-6">
                </div>
            </div>

            <div class="relative">
                <div class="absolute inset-0 -z-5 blur-3xl bg-gradient-to-br from-primary/30 via-secondary/30 to-accent/20"></div>
                <div class="glass rounded-3xl p-6 border border-white/40 shadow-2xl space-y-4">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-full bg-primary/10 text-primary flex items-center justify-center text-xl">
                            <i class="fa-solid fa-bullhorn"></i>
                        </div>
                        <div>
                            <p class="text-xs uppercase tracking-wide text-slate-500">Status Sistem</p>
                            <p class="text-lg font-bold text-primary">Event Aktif 24/7</p>
                        </div>
                    </div>
                    <p class="text-sm text-slate-600 leading-relaxed">
                        SI-VOTING memastikan keamanan, transparansi, dan kemudahan dalam setiap proses voting yang berlangsung.
                    </p>
                    <div class="grid grid-cols-2 gap-3 pt-2">
                        <div class="rounded-2xl border border-white/60 bg-white/70 p-3 text-center">
                            <p class="text-2xl font-extrabold text-primary">100%</p>
                            <p class="text-xs text-slate-500">Transparan</p>
                        </div>
                        <div class="rounded-2xl border border-white/60 bg-white/70 p-3 text-center">
                            <p class="text-2xl font-extrabold text-secondary">Real-time</p>
                            <p class="text-xs text-slate-500">Pemantauan</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="event-list" class="mt-10 space-y-6">
        <div th:if="${success}" class="glass rounded-2xl p-4 border-l-4 border-green-500 bg-green-50/50">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-check-circle text-green-600 text-xl"></i>
                <p class="text-green-800 font-semibold" th:text="${success}">Berhasil</p>
            </div>
        </div>

        <div th:if="${error}" class="glass rounded-2xl p-4 border-l-4 border-red-500 bg-red-50/50">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-exclamation-circle text-red-600 text-xl"></i>
                <p class="text-red-800 font-semibold" th:text="${error}">Gagal</p>
            </div>
        </div>

        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <h2 class="text-2xl md:text-3xl font-bold text-primary">Event Publik Tersedia</h2>
                <p class="text-slate-600">Ikuti event favoritmu dan berikan dukungan terbaik.</p>
            </div>
            <div class="flex w-full md:w-auto gap-3">
                <div class="flex-1 md:flex-none md:w-80">
                    <label class="relative block">
                        <span class="absolute inset-y-0 left-3 flex items-center text-slate-400"><i class="fa-solid fa-magnifying-glass"></i></span>
                        <input id="publicEventsSearch" type="search" placeholder="Cari event berdasarkan judul..." class="w-full rounded-2xl border border-white/80 bg-white/70 py-3 pl-10 pr-4 text-sm text-slate-600 focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20">
                    </label>
                </div>
                <button type="button" id="openCodeModalSecondary" class="px-5 py-3 rounded-2xl bg-gradient-to-br from-primary to-emerald-600 text-white font-semibold text-sm shadow hover:shadow-lg transition flex items-center gap-2">
                    <i class="fa-solid fa-key"></i>
                    <span>Masukkan Kode</span>
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            <div th:if="${events == null or #lists.isEmpty(events)}" class="col-span-full bg-white/80 border border-dashed border-primary/30 rounded-3xl p-12 text-center text-slate-500">
                <div class="mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 text-primary flex items-center justify-center text-2xl">
                    <i class="fa-solid fa-calendar-xmark"></i>
                </div>
                <h3 class="text-xl font-semibold text-primary mb-2">Belum Ada Event</h3>
                <p class="max-w-md mx-auto">Saat ini belum ada event yang tersedia untuk diikuti. Coba kembali beberapa saat lagi atau buat event pertamamu.</p>
            </div>

            <article th:each="event : ${events}" class="group rounded-3xl border border-white/70 bg-white/85 p-6 shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-1" data-event-card
                     th:attr="data-title=${event.title}, data-description=${event.description != null ? event.description : ''}">
                <div class="flex items-center justify-between mb-4">
                    <span th:if="${event.isActive}"
                          class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-br from-green-500 to-emerald-500 text-white shadow">
                        <i class="fa-solid fa-bolt"></i>
                        Aktif
                    </span>
                    <span th:unless="${event.isActive}"
                          class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-br from-gray-500 to-slate-500 text-white shadow">
                        <i class="fa-solid fa-clock"></i>
                        Segera
                    </span>
              <span class="text-xs text-slate-400"
                  th:text="${event.startDateShort != null ? event.startDateShort : '-'}"
                  th:attr="title=${event.startDateFormatted}">--·--·----</span>
                </div>

                <h3 class="text-lg font-bold text-primary mb-2 line-clamp-2" th:text="${event.title}">Judul Event</h3>
                <p class="text-sm text-slate-600 leading-relaxed line-clamp-3" th:text="${event.description ?: 'Event ini belum memiliki deskripsi.'}">
                    Deskripsi event...
                </p>

                <div class="mt-4 flex items-center justify-between">
                    <div class="flex -space-x-3" th:if="${event.candidates != null and !#lists.isEmpty(event.candidates)}">
                        <div th:each="candidate, iterStat : ${event.candidates}" th:if="${iterStat.index < 5}"
                             class="w-10 h-10 rounded-2xl border-2 border-white overflow-hidden bg-primary/10 flex items-center justify-center text-sm font-semibold text-primary shadow">
                            <div th:if="${candidate.photoUrl != null and !#strings.isEmpty(candidate.photoUrl)}">
                                <img th:src="${candidate.photoUrl}" th:alt="${candidate.name}"
                                     class="w-full h-full object-cover">
                            </div>
                            <span th:unless="${candidate.photoUrl != null and !#strings.isEmpty(candidate.photoUrl)}"
                                  th:text="${candidate.name != null ? candidate.name.substring(0, 1).toUpperCase() : 'C'}"></span>
                        </div>
                        <div th:if="${event.candidates.size() > 5}"
                             class="w-10 h-10 rounded-2xl border-2 border-white bg-primary text-white flex items-center justify-center text-xs font-semibold shadow">
                            <span th:text="${'+' + (event.candidates.size() - 5)}"></span>
                        </div>
                    </div>
                    <div class="text-xs text-slate-500" th:if="${event.candidates != null and !#lists.isEmpty(event.candidates)}">
                        <span class="font-semibold text-primary" th:text="${event.candidates.size()}">0</span>
                        <span>Kandidat tersedia</span>
                    </div>
                </div>

                <div class="mt-5 flex items-center justify-between text-xs text-slate-500">
                    <div class="flex items-center gap-2">
                        <i class="fa-solid fa-users"></i>
                        <span th:text="${event.candidates != null ? #lists.size(event.candidates) : 0}">0</span>
                        <span>Kandidat</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fa-solid fa-shield"></i>
                        <span th:text="${event.isPublic ? 'Publik' : 'Privat'}">Publik</span>
                    </div>
                </div>

                <div class="mt-6 flex">
                    <a th:href="@{/events/{code}(code=${event.code})}"
                       class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-2xl text-sm font-semibold bg-gradient-to-r from-primary to-accent text-white shadow-lg hover:shadow-xl transition">
                        <i class="fa-solid fa-circle-info"></i>
                        Lihat Detail
                    </a>
                </div>
            </article>
            <div id="noEventSearchResult" class="hidden col-span-full bg-white/80 border border-dashed border-primary/30 rounded-3xl p-12 text-center text-slate-500">
                <div class="mx-auto mb-4 w-16 h-16 rounded-full bg-primary/10 text-primary flex items-center justify-center text-2xl">
                    <i class="fa-solid fa-search"></i>
                </div>
                <h3 class="text-xl font-semibold text-primary mb-2">Tidak ada event yang cocok</h3>
                <p class="max-w-md mx-auto">Coba gunakan kata kunci lain atau cek kembali daftar event.</p>
            </div>
        </div>

    <section class="mt-12 space-y-5">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-2xl font-bold text-primary">Riwayat Voting</h3>
                    <p class="text-slate-600">Event yang sudah kamu ikut serta beri suara.</p>
                </div>
                <div class="hidden md:flex items-center gap-2 text-xs text-slate-400 uppercase tracking-[0.25em]">
                    <span>Status</span>
                    <span class="w-1 h-1 rounded-full bg-secondary"></span>
                </div>
            </div>

            <div th:if="${votedEvents == null or #lists.isEmpty(votedEvents)}" class="glass rounded-3xl border border-dashed border-primary/30 bg-white/70 p-10 text-center text-slate-500">
                <p class="font-semibold text-primary mb-2">Belum ada riwayat voting.</p>
                <p class="text-sm">Event yang sudah kamu berikan suara akan muncul di sini.</p>
            </div>

            <div th:if="${votedEvents != null and !#lists.isEmpty(votedEvents)}" class="space-y-4">
                <article th:each="event : ${votedEvents}" class="glass rounded-3xl border border-white/60 bg-white/80 p-6 shadow group">
                    <div class="flex flex-col gap-4 md:flex-row md:items-start md:justify-between">
                        <div class="space-y-2">
                            <div class="flex items-center gap-3 text-xs uppercase tracking-wide">
                                <span class="px-3 py-1 rounded-full font-semibold"
                                      th:classappend=" ${event.timelineBadgeClass}"
                                      th:text="${event.timelineStatus}">Selesai</span>
                      <span class="text-slate-400"
                          th:text="${event.startDateShort != null ? event.startDateShort : '-'}"
                          th:attr="title=${event.startDateFormatted}">07 Nov 2025</span>
                                <span class="text-slate-300">•</span>
                      <span class="text-slate-400"
                          th:text="${event.endDateShort != null ? event.endDateShort : '-'}"
                          th:attr="title=${event.endDateFormatted}">08 Nov 2025</span>
                                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 font-semibold">
                                    <i class="fa-solid fa-check"></i>
                                    <span>Sudah Vote</span>
                                </span>
                            </div>
                            <h4 class="text-lg font-semibold text-primary" th:text="${event.title}">Judul Event</h4>
                            <p class="text-sm text-slate-600 leading-relaxed line-clamp-2" th:text="${event.description ?: 'Event ini tidak memiliki deskripsi tambahan.'}">
                                Deskripsi event untuk riwayat.
                            </p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-3 items-start">
                            <div class="rounded-2xl border border-white/60 bg-white/80 px-4 py-2 text-center text-xs text-slate-500">
                                <p class="text-lg font-bold text-primary" th:text="${event.candidates != null ? #lists.size(event.candidates) : 0}">0</p>
                                <p class="uppercase tracking-widest text-[10px]">Kandidat</p>
                            </div>
                            <a th:href="@{/events/{code}(code=${event.code})}"
                               class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl bg-primary/10 text-primary font-semibold text-sm hover:bg-primary/15 transition">
                                <i class="fa-solid fa-eye"></i>
                                Lihat Detail
                            </a>
                        </div>
                    </div>
                </article>
            </div>
        </section>
    </section>
    <section>
        <div id="codeModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 items-center justify-center p-4">
            <div class="glass rounded-3xl p-8 w-full max-w-md shadow-2xl relative border border-white/40">
                <button type="button" id="closeCodeModal" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 transition">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-primary mb-1">Masukkan Kode Event</h3>
                <p class="text-sm text-slate-500">Gunakan kode unik yang diberikan penyelenggara untuk bergabung.</p>
            </div>
            <form method="get" th:action="@{/events/join}" class="space-y-4">
                <div>
                    <label for="eventCodeInput" class="block text-sm font-semibold text-slate-600 mb-2">Kode Event</label>
                    <input id="eventCodeInput" name="code" type="text" maxlength="12" class="w-full rounded-2xl border border-primary/30 bg-white/90 px-4 py-3 text-base text-slate-700 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary uppercase tracking-widest" placeholder="Contoh: VOTE2025" required>
                </div>
                <button type="submit" class="w-full px-6 py-3 rounded-2xl bg-gradient-to-r from-primary to-accent text-white font-semibold shadow-lg hover:shadow-xl transition">
                    Gabung Sekarang
                </button>
            </form>
        </div>
    </section>
    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const alerts = document.querySelectorAll('.border-l-4');
            if (alerts.length > 0) {
                setTimeout(() => {
                    alerts.forEach((alert) => {
                        alert.style.transition = 'opacity 0.5s';
                        alert.style.opacity = '0';
                        setTimeout(() => alert.remove(), 500);
                    });
                }, 5000);
            }

            const searchInput = document.getElementById('publicEventsSearch');
            const eventCards = Array.from(document.querySelectorAll('[data-event-card]'));
            const noResultPlaceholder = document.getElementById('noEventSearchResult');

            if (searchInput && eventCards.length > 0) {
                const filterEvents = () => {
                    const query = searchInput.value.trim().toLowerCase();
                    let visibleCount = 0;

                    eventCards.forEach((card) => {
                        const title = (card.dataset.title || '').toLowerCase();
                        const description = (card.dataset.description || '').toLowerCase();
                        const matches = query === '' || title.includes(query) || description.includes(query);
                        card.style.display = matches ? '' : 'none';
                        if (matches) {
                            visibleCount += 1;
                        }
                    });

                    if (noResultPlaceholder) {
                        const shouldShow = visibleCount === 0 && query !== '';
                        noResultPlaceholder.classList.toggle('hidden', !shouldShow);
                    }
                };

                searchInput.addEventListener('input', filterEvents);
                filterEvents();
            }
        });

    const codeModal = document.getElementById('codeModal');
    const openCodeModalBtn = document.getElementById('openCodeModal');
    const openCodeModalBtnSecondary = document.getElementById('openCodeModalSecondary');
        const closeCodeModalBtn = document.getElementById('closeCodeModal');
        const codeInput = document.getElementById('eventCodeInput');

        const openModal = () => {
            if (codeModal) {
                codeModal.classList.remove('hidden');
                codeModal.classList.add('flex');
                setTimeout(() => codeInput && codeInput.focus(), 100);
            }
        };

        const closeModal = () => {
            if (codeModal) {
                codeModal.classList.add('hidden');
                codeModal.classList.remove('flex');
                if (codeInput) {
                    codeInput.value = '';
                }
            }
        };

        if (openCodeModalBtn) {
            openCodeModalBtn.addEventListener('click', openModal);
        }

        if (openCodeModalBtnSecondary) {
            openCodeModalBtnSecondary.addEventListener('click', openModal);
        }

        if (closeCodeModalBtn) {
            closeCodeModalBtn.addEventListener('click', closeModal);
        }

        if (codeModal) {
            codeModal.addEventListener('click', (event) => {
                if (event.target === codeModal) {
                    closeModal();
                }
            });
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && codeModal && !codeModal.classList.contains('hidden')) {
                closeModal();
            }
        });
    </script>
</th:block>
</html>
